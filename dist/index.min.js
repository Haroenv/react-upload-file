!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports["react-fileupload"]=t(require("react")):e["react-fileupload"]=t(e.React)}(this,function(e){return function(e){function t(i){if(o[i])return o[i].exports;var a=o[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){e.exports=o(1)},function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),u=o(2),d=i(u),f=function(){},h=0,c=[!0],m=[],y=0,v=function(e){function t(){var e,o,i,r;a(this,t);for(var n=arguments.length,p=Array(n),l=0;l<n;l++)p[l]=arguments[l];return o=i=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),i.state={chooseBtn:{},uploadBtn:{},before:[],middle:[],after:[]},r=o,s(i,r)}return r(t,e),l(t,[{key:"componentWillMount",value:function(){this.userAgent=this.getUserAgent(),this.isIE=!(this.checkIE()<0||this.checkIE()>=10);var e=this.props.options&&this.props.options.tag;this.IETag=e?e+"_":"",this.updateProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.updateProps(e)}},{key:"getUserAgent",value:function(){var e=this.props.options&&this.props.options.userAgent,t="undefined"!=typeof navigator;if(!t&&!e)throw new Error("`options.userAgent` must be set rendering react-fileuploader in situations when `navigator` is not defined in the global namespace. (on the server, for example)");return t?navigator.userAgent:e}},{key:"updateProps",value:function(e){var t=this;this.isIE=!(this.checkIE()<0||this.checkIE()>=10);var o=e.options;this.baseUrl=o.baseUrl,this.param=o.param,this.chooseAndUpload=o.chooseAndUpload||!1,this.paramAddToField=o.paramAddToField||void 0,this.dataType="json",o.dataType&&"text"===o.dataType.toLowerCase()&&(this.dataType="text"),this.wrapperDisplay=o.wrapperDisplay||"inline-block",this.timeout="number"==typeof o.timeout&&o.timeout>0?o.timeout:0,this.accept=o.accept||"",this.multiple=o.multiple||!1,this.numberLimit=o.numberLimit||!1,this.fileFieldName=o.fileFieldName||!1,this.withCredentials=o.withCredentials||!1,this.requestHeaders=o.requestHeaders||!1,this.parent=e.parent,this.beforeChoose=o.beforeChoose||f,this.chooseFile=o.chooseFile||f,this.beforeUpload=o.beforeUpload||f,this.doUpload=o.doUpload||f,this.uploading=o.uploading||f,this.uploadSuccess=o.uploadSuccess||f,this.uploadError=o.uploadError||f,this.uploadFail=o.uploadFail||f,this.onabort=o.onabort||f,this.files=o.files||this.files||!1,this.disabledIEChoose=o.disabledIEChoose||!1,this.withoutFileUpload=o.withoutFileUpload||!1,this.filesToUpload=o.filesToUpload||[],this.textBeforeFiles=o.textBeforeFiles||!1,this.filesToUpload.length&&!this.isIE&&this.filesToUpload.forEach(function(e){t.files=[e],t.commonUpload()});var i=void 0,a=void 0,s=0,r=[],n=[],p=[];this.chooseAndUpload?d.default.Children.forEach(e.children,function(e){e&&"chooseAndUpload"===e.ref?(i=e,s++):0===s?r.push(e):1===s?n.push(e):""}):d.default.Children.forEach(e.children,function(e){e&&"chooseBtn"===e.ref?(i=e,s++):e&&"uploadBtn"===e.ref?(a=e,s++):0===s?r.push(e):1===s?n.push(e):p.push(e)}),this.setState({chooseBtn:i,uploadBtn:a,before:r,middle:n,after:p})}},{key:"commonChooseFile",value:function(){var e=this.beforeChoose();e!==!0&&void 0!==e||this.refs.ajax_upload_file_input.click()}},{key:"commonChange",value:function(e){var t=void 0;e.dataTransfer?t=e.dataTransfer.files:e.target?t=e.target.files:"";var o="function"==typeof this.numberLimit?this.numberLimit():this.numberLimit;if(this.multiple&&o&&t.length>o){for(var i={},a=0;a<o;a++)i[a]=t[a];i.length=o,t=i}this.files=t,this.chooseFile(t,this.parent),this.chooseAndUpload&&this.commonUpload()}},{key:"commonUpload",value:function(){var e=this,t=this.files.length&&this.files[0].mill||(new Date).getTime(),o=this.beforeUpload(this.files,this.parent,t);if(o!==!0&&void 0!==o&&"object"!==("undefined"==typeof o?"undefined":p(o)))return void(this.refs.ajax_upload_file_input.value="");if(this.files){if(!this.baseUrl)throw new Error("baseUrl missing in options");var i={},a=new FormData;this.textBeforeFiles&&(a=this.appendFieldsToFormData(a)),this.withoutFileUpload||!function(){var t=p(e.fileFieldName);Object.keys(e.files).forEach(function(o){if("length"!==o)if("function"===t){var i=e.files[o],s=e.fileFieldName(i);a.append(s,i)}else if("string"===t){var r=e.files[o];a.append(e.fileFieldName,r)}else{var n=e.files[o];a.append(n.name,n)}})}(),this.textBeforeFiles||(a=this.appendFieldsToFormData(a));var s=this.baseUrl,r="function"==typeof this.param?this.param(this.files):this.param,n="";r&&!function(){var e=[];r._=t,Object.keys(r).forEach(function(t){return e.push(t+"="+r[t])}),n="?"+e.join("&")}();var l=s+n,u=new XMLHttpRequest;u.open("POST",l,!0),u.withCredentials=this.withCredentials;var d=this.requestHeaders;d&&Object.keys(d).forEach(function(e){return u.setRequestHeader(e,d[e])}),this.timeout&&(u.timeout=this.timeout,u.ontimeout=function(){e.uploadError({type:"TIMEOUTERROR",message:"timeout"},e.parent),i.isTimeout=!1},i.isTimeout=!1,setTimeout(function(){i.isTimeout=!0},this.timeout)),u.onreadystatechange=function(){try{if(4===u.readyState&&u.status>=200&&u.status<400){var t="json"===e.dataType?JSON.parse(u.responseText):u.responseText;e.uploadSuccess(t,e.parent)}else if(4===u.readyState){var o="json"===e.dataType?JSON.parse(u.responseText):u.responseText;e.uploadFail(o,e.parent)}}catch(a){!i.isTimeout&&e.uploadError({type:"FINISHERROR",message:a.message},e.parent)}},u.onerror=function(){try{var t="json"===e.dataType?JSON.parse(u.responseText):u.responseText;e.uploadError({type:"XHRERROR",message:t},e.parent)}catch(o){e.uploadError({type:"XHRERROR",message:o.message},e.parent)}},u.onprogress=u.upload.onprogress=function(o){e.uploading(o,e.parent,t)},this.withoutFileUpload?u.send(null):u.send(a),m.push(u);var f=m.length-1;y=f,u.onabort=function(){return e.onabort(e.parent,t,f)},this.doUpload(this.files,this.parent,t,y),this.refs.ajax_upload_file_input.value=""}}},{key:"appendFieldsToFormData",value:function(e){var t="function"==typeof this.paramAddToField?this.paramAddToField():this.paramAddToField;return t&&Object.keys(t).map(function(o){return e.append(o,t[o])}),e}},{key:"IEBeforeChoose",value:function(e){var t=this.beforeChoose();t!==!0&&void 0!==t&&e.preventDefault()}},{key:"IEChooseFile",value:function(e){this.fileName=e.target.value.substring(e.target.value.lastIndexOf("\\")+1),this.chooseFile(this.fileName,this.parent),this.chooseAndUpload&&this.IEUpload()!==!1&&document.getElementById("ajax_upload_file_form_"+this.IETag+h).submit(),e.target.blur()}},{key:"IEUpload",value:function(e){function t(){clearInterval(m);try{s.uploadSuccess(s.IECallback(s.dataType,y),this.parent)}catch(e){s.uploadError(e,this.parent)}finally{var t=document.getElementById("ajax_upload_hidden_input_"+s.IETag+y);t.outerHTML=t.outerHTML}}var o=this,i=(new Date).getTime(),a=this.beforeUpload(this.fileName,this.parent,i);if(!this.fileName||a!==!0&&void 0!==a)return e&&e.preventDefault(),!1;var s=this,r=this.baseUrl,n="function"==typeof this.param?this.param(this.fileName):this.param,p="";n&&!function(){var e=[];n._=i,void 0===n.ie&&(n.ie="true"),Object.keys(n).forEach(function(t){void 0!==n[t]&&e.push(t+"="+n[t])}),p="?"+e.join("&")}();var l=r+p;document.getElementById("ajax_upload_file_form_"+this.IETag+h).setAttribute("action",l);var u=this.fakeProgress(),d=0,f=0,m=setInterval(function(){d=u(d),o.uploading({loaded:d,total:100},o.parent,i),++f>=150&&clearInterval(m)},200),y=h;window.attachEvent?document.getElementById("ajax_upload_file_frame_"+this.IETag+y).attachEvent("onload",t):document.getElementById("ajax_upload_file_frame_"+this.IETag+y).addEventListener("load",t),this.doUpload(this.fileName,this.parent,i),c[h]=!1}},{key:"IECallback",value:function(e,t){c[t]=!0;var o=document.getElementById("ajax_upload_file_frame_"+this.IETag+t),i={},a=o.contentWindow?o.contentWindow.document.body:o.contentDocument.document.body;if(!a)throw new Error("Your browser does not support async upload");try{i.responseText=a.innerHTML||"null innerHTML",i.json=JSON?JSON.parse(i.responseText):""+i.responseText}catch(s){if(s.message&&s.message.indexOf("Unexpected token")>=0){if(i.responseText.indexOf("{")>=0){var r=i.responseText.substring(i.responseText.indexOf("{"),i.responseText.lastIndexOf("}")+1);return JSON?JSON.parse(r):""+r}return{type:"FINISHERROR",message:s.message}}throw s}return"json"===e?i.json:i.responseText}},{key:"forwardChoose",value:function(){return!this.isIE&&void this.commonChooseFile()}},{key:"fowardRemoveFile",value:function(e){this.files=e(this.files)}},{key:"filesToUpload",value:function(e){this.isIE||(this.files=e,this.commonUpload())}},{key:"abort",value:function(e){void 0===e?m[y].abort():m[e].abort()}},{key:"checkIE",value:function(){var e=this.userAgent,t=e.indexOf("MSIE");return t<0?-1:parseFloat(e.substring(t+5,e.indexOf(";",t)))}},{key:"fakeProgress",value:function(){var e=6,t=.3,o=98,i=.2;return function(a){var s=a;return s>=o?s:(s+=e,e-=t,e<i&&(e=i),s)}}},{key:"multiIEForm",value:function(){function e(e,t){if(!c[t]||!o){var a=c[t],s={position:"absolute",left:"-30px",top:0,zIndex:"50",fontSize:"80px",width:"200px",opacity:0,filter:"alpha(opacity=0)"},r={accept:this.accept,disabled:i},p=d.default.createElement("input",n({type:"file",name:"ajax_upload_hidden_input_"+t,id:"ajax_upload_hidden_input_"+t,ref:"ajax_upload_hidden_input_"+t,onChange:this.IEChooseFile,onClick:this.IEBeforeChoose,style:s},r));t=""+this.IETag+t,e.push(d.default.createElement("form",{id:"ajax_upload_file_form_"+t,method:"post",target:"ajax_upload_file_frame_"+t,key:"ajax_upload_file_form_"+t,encType:"multipart/form-data",ref:"form_"+t,onSubmit:this.IEUpload,style:{display:a?"block":"none"}},this.state.before,d.default.createElement("div",{style:{overflow:"hidden",position:"relative",display:"inline-block"}},this.state.chooseBtn,p),this.state.middle,d.default.createElement("div",{style:{overflow:"hidden",position:"relative",display:this.chooseAndUpload?"none":this.wrapperDisplay}},this.state.uploadBtn,d.default.createElement("input",{type:"submit",style:{position:"absolute",left:0,top:0,fontSize:"50px",width:"200px",opacity:0}})),this.state.after)),e.push(d.default.createElement("iframe",{id:"ajax_upload_file_frame_"+t,name:"ajax_upload_file_frame_"+t,key:"ajax_upload_file_frame_"+t,className:"ajax_upload_file_frame",style:{display:"none",width:0,height:0,margin:0,border:0}}))}}for(var t=[],o=!1,i="function"==typeof this.disabledIEChoose?this.disabledIEChoose():this.disabledIEChoose,a=0;a<c.length;a++)e.call(this,t,a),c[a]&&!o&&(o=!0,h=a),a!==c.length-1||o||c.push(!0);return d.default.createElement("div",{className:this.props.className,style:this.props.style,id:"react-file-uploader"},t)}},{key:"render",value:function(){if(this.isIE)return this.multiIEForm();var e={accept:this.accept,multiple:this.multiple};return d.default.createElement("div",{className:this.props.className,style:this.props.style},this.state.before,d.default.createElement("div",{onClick:this.commonChooseFile,style:{overflow:"hidden",postion:"relative",display:this.wrapperDisplay}},this.state.chooseBtn),this.state.middle,d.default.createElement("div",{onClick:this.commonUpload,style:{overflow:"hidden",postion:"relative",display:this.chooseAndUpload?"none":this.wrapperDisplay}},this.state.uploadBtn),this.state.after,d.default.createElement("input",n({type:"file",name:"ajax_upload_file_input",ref:"ajax_upload_file_input",style:{display:"none"},onChange:this.commonChange},e)))}}]),t}(u.Component);v.propTypes={options:u.PropTypes.shape({baseUrl:u.PropTypes.string.isRequired,param:u.PropTypes.oneOfType([u.PropTypes.object,u.PropTypes.func]),dataType:u.PropTypes.string,chooseAndUpload:u.PropTypes.bool,paramAddToField:u.PropTypes.oneOfType([u.PropTypes.object,u.PropTypes.func]),wrapperDisplay:u.PropTypes.string,timeout:u.PropTypes.number,accept:u.PropTypes.string,multiple:u.PropTypes.bool,numberLimit:u.PropTypes.oneOfType([u.PropTypes.number,u.PropTypes.func]),fileFieldName:u.PropTypes.oneOfType([u.PropTypes.string,u.PropTypes.func]),withCredentials:u.PropTypes.bool,requestHeaders:u.PropTypes.object,tag:u.PropTypes.string,userAgent:u.PropTypes.string,disabledIEChoose:u.PropTypes.oneOfType([u.PropTypes.bool,u.PropTypes.func]),withoutFileUpload:u.PropTypes.bool,filesToUpload:u.PropTypes.arrayOf(u.PropTypes.object),textBeforeFiles:u.PropTypes.bool,beforeChoose:u.PropTypes.func,chooseFile:u.PropTypes.func,beforeUpload:u.PropTypes.func,doUpload:u.PropTypes.func,uploading:u.PropTypes.func,uploadSuccess:u.PropTypes.func,uploadError:u.PropTypes.func,uploadFail:u.PropTypes.func,onabort:u.PropTypes.func}).isRequired,parent:u.PropTypes.object,style:u.PropTypes.object,className:u.PropTypes.string},t.default=v},function(t,o){t.exports=e}])});