!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o(require("react")):"function"==typeof define&&define.amd?define(["react"],o):"object"==typeof exports?exports["react-upload-file"]=o(require("react")):e["react-upload-file"]=o(e.React)}(this,function(e){return function(e){function o(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}var t={};return o.m=e,o.c=t,o.p="",o(0)}([function(e,o,t){e.exports=t(1)},function(e,o,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function n(e){if(Array.isArray(e)){for(var o=0,t=Array(e.length);o<e.length;o++)t[o]=e[o];return t}return Array.from(e)}function a(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function i(e,o){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?e:o}function p(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}Object.defineProperty(o,"__esModule",{value:!0});var s=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(o,t,r){return t&&e(o.prototype,t),r&&e(o,r),o}}(),f=t(2),c=r(f),d=function(e){function o(e){a(this,o);var t=i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));t.state={xhrList:[],currentXHRID:0},t.commonChooseFile=function(e){if("function"==typeof t.beforeChoose){var o=t.beforeChoose();if(o!==!0&&void 0!==o)return;e.target.click()}},t.commonChangeFile=function(e){var o=void 0;e.dataTransfer?o=e.dataTransfer.files:e.target&&(o=e.target.files);var r="function"==typeof t.numberLimit?t.numberLimit():t.numberLimit;t.multiple&&r&&o.length>r&&!function(){var e={};o.forEach(function(o,t){e[t]=o}),e.length=r,o=e}(),t.files=o,console.log(t.files),t.onChoose(o),t.uploadFile||t.commonUploadFile(e)},t.commonUploadFile=function(e){for(var o=t.files.length&&t.files[0].mill||(new Date).getTime(),r=t.files.length,a=[],i=0;i<r;i++){var p=t.files[i];a.push({name:p.name,lastModified:p.lastModified,lastModifiedDate:p.lastModifiedDate,path:p.path,size:p.size,type:p.type,webkitRelativePath:p.webkitRelativePath})}var s=t.beforeUpload(a,o);if(s!==!0&&void 0!==s&&"object"!==("undefined"==typeof s?"undefined":l(s)))return e.target.value="",!1;if(t.files){if(!t.baseUrl)throw new Error("baseUrl missing in options");var u={},f=new FormData;f=t.appendFieldsToFormData(f),t.withoutFileUpload||!function(){var e=l(t.fileFieldName);Object.keys(t.files).forEach(function(o){if("length"!==o)if("function"===e){var r=t.files[o],n=t.fileFieldName(r);f.append(n,r)}else if("string"===e){var a=t.files[o];f.append(t.fileFieldName,a)}else{var i=t.files[o];f.append(i.name,i)}})}();var c=t.baseUrl,d="function"==typeof t.param?t.param(t.files):t.param,y="";d&&!function(){var e=[];d._=o,Object.keys(d).forEach(function(o){return e.push(o+"="+d[o])}),y="?"+e.join("&")}();var m=c+y,T=new XMLHttpRequest;T.open("POST",m,!0),T.withCredentials=t.withCredentials;var h=t.requestHeaders;h&&Object.keys(h).forEach(function(e){return T.setRequestHeader(e,h[e])}),t.timeout&&(T.timeout=t.timeout,T.ontimeout=function(){t.uploadError({type:"TIMEOUTERROR",message:"timeout"}),u.isTimeout=!1},u.isTimeout=!1,setTimeout(function(){u.isTimeout=!0},t.timeout)),T.onreadystatechange=function(){try{if(4===T.readyState&&T.status>=200&&T.status<400){var e="json"===t.dataType?JSON.parse(T.responseText):T.responseText;t.uploadSuccess(e)}else if(4===T.readyState){var o="json"===t.dataType?JSON.parse(T.responseText):T.responseText;t.uploadFail(o)}}catch(r){u.isTimeout||t.uploadError({type:"FINISHERROR",message:r.message})}},T.onerror=function(){try{var e="json"===t.dataType?JSON.parse(T.responseText):T.responseText;t.uploadError({type:"XHRERROR",message:e})}catch(o){t.uploadError({type:"XHRERROR",message:o.message})}},T.onprogress=T.upload.onprogress=function(e){t.uploading(e,o)},t.withoutFileUpload?T.send(null):T.send(f);var b=t.state.xhrList.length-1;t.setState({currentXHRID:b,xhrList:[].concat(n(t.state.xhrList),[T])}),T.onabort=function(){return t.onAbort(o,b)},t.didUpload(t.files,o,t.state.currentXHRID),e.target.value=""}},t.appendFieldsToFormData=function(e){var o="function"==typeof t.paramAddToField?t.paramAddToField():t.paramAddToField;return o&&Object.keys(o).forEach(function(t){e.append(t,o[t])}),e},t.forwardChooseFile=function(){t.commonChooseFile()},t.fowardRemoveFile=function(e){t.files=e(t.files)},t.filesToUpload=function(e){t.files=e,t.commonUploadFile()},t.abort=function(e){e?t.state.xhrList[e].abort():t.state.xhrList[t.state.currentXHRID].abort()};var r=e.options;return t.timeout="number"==typeof r.timeout&&r.timeout>0?r.timeout:0,t.dataType=r.dataType&&"text"===r.dataType.toLowerCase()?"text":t.dataType,Object.keys(r).forEach(function(e){t[e]=r[e]||t[e]}),t.filesToUpload.length&&t.filesToUpload.forEach(function(e){t.files=[e],t.commonUploadFile()}),t}return p(o,e),u(o,[{key:"render",value:function(){var e={accept:this.props.options.accept,multiple:this.props.options.multiple},o=c.default.cloneElement(this.props.chooseFile||c.default.createElement("button",null),{onClick:this.commonChooseFile},[c.default.createElement("input",s({type:"file",name:"ajax-upload-file-input",style:{display:"none"},onChange:this.commonChangeFile},e))]),t=c.default.cloneElement(this.props.uploadFile||c.default.createElement("button",null),{onClick:this.commonUploadFile});return c.default.createElement("div",null,o,t)}}]),o}(f.Component);d.propTypes={options:f.PropTypes.shape({baseUrl:f.PropTypes.string.isRequired,param:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.func]),dataType:f.PropTypes.string,paramAddToField:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.func]),timeout:f.PropTypes.number,numberLimit:f.PropTypes.oneOfType([f.PropTypes.number,f.PropTypes.func]),fileFieldName:f.PropTypes.oneOfType([f.PropTypes.string,f.PropTypes.func]),withCredentials:f.PropTypes.bool,requestHeaders:f.PropTypes.object,accept:f.PropTypes.string,multiple:f.PropTypes.bool,userAgent:f.PropTypes.string,withoutFileUpload:f.PropTypes.bool,filesToUpload:f.PropTypes.arrayOf(f.PropTypes.object),beforeChoose:f.PropTypes.func,onChoose:f.PropTypes.func,beforeUpload:f.PropTypes.func,didUpload:f.PropTypes.func,uploading:f.PropTypes.func,uploadSuccess:f.PropTypes.func,uploadError:f.PropTypes.func,uploadFail:f.PropTypes.func,onAbort:f.PropTypes.func}).isRequired,style:f.PropTypes.object,className:f.PropTypes.string,chooseFile:f.PropTypes.element,uploadFile:f.PropTypes.element},d.defaultProps={options:f.PropTypes.shape({param:null,dataType:"json",paramAddToField:null,timeout:3e4,numberLimit:10,withCredentials:!1,accept:"",multiple:!1,userAgent:window.navigator.userAgent,withoutFileUpload:!1,filesToUpload:[],beforeChoose:null,onChoose:null,beforeUpload:null,didUpload:null,uploading:null,uploadSuccess:null,uploadError:null,uploadFail:null,onAbort:null}).isRequired,style:f.PropTypes.object,className:f.PropTypes.string,chooseFile:f.PropTypes.element,uploadFile:f.PropTypes.element},o.default=d},function(o,t){o.exports=e}])});